<meta name="turbolinks-visit-control" content="reload">

<style>
.toggle_input {
  /* position: absolute; */
  /* left: 0;
  top: 0; */
  /* width: 100%;
  height: 100%; */
  z-index: 5;
  opacity: 0;
  cursor: pointer;
}

.toggle_label {
  width: 30px;
  height: 15px;
  background: #ccc;
  position: relative;
  display: inline-block;
  border-radius: 40px;
  transition: 0.4s;
  box-sizing: border-box;
}

.toggle_label:after {
  content: "";
  position: absolute;
  width: 15px;
  height: 15px;
  border-radius: 100%;
  left: 0;
  top: 0;
  z-index: 2;
  background: #fff;
  box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
  transition: 0.3s;
}

.toggle_input:checked + .toggle_label {
  background-color: #4BD865;
}

.toggle_input:checked + .toggle_label:after {
  left: 16px;
}

.toggle_button {
  display: flex;
  align-items: center;
  margin-bottom: 20px; /* ãƒœã‚¿ãƒ³é–“ã®ã‚¹ãƒšãƒ¼ã‚¹ã‚’è¿½åŠ  */
}

.toggle_button label {
  margin-left: 10px; /* ãƒˆã‚°ãƒ«ãƒœã‚¿ãƒ³ã¨ãƒ†ã‚­ã‚¹ãƒˆã®é–“ã«ã‚¹ãƒšãƒ¼ã‚¹ã‚’è¿½åŠ  */
}

.toggle_button input {
  margin-left: 10px; /* ãƒˆã‚°ãƒ«ãƒœã‚¿ãƒ³ã¨ãƒ†ã‚­ã‚¹ãƒˆã®é–“ã«ã‚¹ãƒšãƒ¼ã‚¹ã‚’è¿½åŠ  */
}

/* ã‚ªãƒ¼ãƒ—ãƒ³æ™‚ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¨­å®š */
details[open] .details-content {
  animation: fadeIn 0.5s ease;
}
@keyframes fadeIn {
  0% {
    opacity: 0; /* é€æ˜ */
    transform: translateY(-10px); /* ä¸Šã‹ã‚‰è¡¨ç¤º */
  }
  100% {
    opacity: 1;
    transform: none;
  }
}

/* From Uiverse.io by Na3ar-17 */ 
.radio-input {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.radio-input * {
  box-sizing: border-box;
  padding: 0;
  margin: 0;
}

.radio-input label {
  display: flex;
  align-items: center;
  gap: 15px;
  padding: 0px 20px;
  width: 220px;
  cursor: pointer;
  height: 50px;
  position: relative;
}

.radio-input label::before {
  position: absolute;
  content: "";
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 220px;
  height: 45px;
  z-index: 0;
  transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
  border-radius: 10px;
  border: 2px solid transparent;
}
.radio-input label:hover::before {
  transition: all 0.2s ease;
  background-color: #2a2e3c;
}

.radio-input .label:has(input:checked)::before {
  background-color: #2d3750;
  border-color: #435dd8;
  height: 50px;
}
.radio-input .label .text {
  color: #fff;
  z-index: 3;
}

.radio-input .label input[type="radio"] {
  background-color: #202030;
  appearance: none;
  width: 17px;
  height: 17px;
  border-radius: 50%;
  display: flex;
  justify-content: center;
  align-items: center;
}
.radio-input .label input[type="radio"]:checked {
  background-color: #435dd8;
  -webkit-animation: puls 0.7s forwards;
  animation: pulse 0.7s forwards;
}

.radio-input .label input[type="radio"]:before {
  content: "";
  width: 6px;
  height: 6px;
  border-radius: 50%;
  transition: all 0.1s cubic-bezier(0.165, 0.84, 0.44, 1);
  background-color: #fff;
  transform: scale(0);
}

.radio-input .label input[type="radio"]:checked::before {
  transform: scale(1);
  z-index: 0;
}

@keyframes pulse {
  0% {
    box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.4);
  }
  70% {
    box-shadow: 0 0 0 8px rgba(255, 255, 255, 0);
  }
  100% {
    box-shadow: 0 0 0 0 rgba(255, 255, 255, 0);
  }
}

.calendar {
  border: 1px solid #ccc;
  border-radius: 5px;
  padding: 20px;
  margin-top: 20px;
}
.calendar-header {
  display: flex;
  align-items: center;
  gap: 10px;
}
.calendar-body {
  margin-top: 20px;
}
.time-slot {
  border: 1px solid #ccc;
  border-radius: 5px;
  padding: 10px;
  min-height: 100px;
}
.practice-card {
  background-color: #f8f9fa;
  border: 1px solid #ccc;
  border-radius: 5px;
  padding: 10px;
  margin-top: 10px;
}

select#practice-select {
  width: 100%;
  -webkit-appearance: none; /* Safari and Chrome */
  -moz-appearance: none; /* Firefox */
  appearance: none; /* Standard */
  padding: 10px;
  border: 1px solid #ccc;
  border-radius: 5px;
  background: url('data:image/svg+xml;utf8,<svg fill="%23333" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>') no-repeat right 10px center;
  background-size: 12px;
  background-color: #fff;
  box-sizing: border-box;
}

@media (max-width: 600px) {
  select#practice-select {
    font-size: 16px;
    padding: 12px;
  }
}

@media (min-width: 992px) {
  .w-lg-50 {
    width: 50% !important;
  }
}

</style>

<div class='container px-lg-5 mb-5'>
  <div class='row'>
    <div class='col-md-12'>
      <h2 style='margin-top: 30px;'><%= @group.name %></h2>
        <td>
          <div class="panel-group">
            <div class="panel panel-default" style="margin-bottom: 30px;">
              <div class="panel-heading">
                <a data-toggle="collapse" href="#collapse2" aria-expanded="false" aria-controls="collapse2">
                  <%= image_tag 'group.png', size: "23x23" %><%= @group.users.size %>
                </a>
              </div>
              <div id="collapse2" class="panel-collapse collapse" aria-labelledby="headingTwo">
                <ul class="list-group">
                  <% @group.users.each do |user| %>
                    <li class="list-group-item"><%= user.username %></li>
                  <% end %>
                </ul>
              </div>
            </div>
          </div>
        </td>

        <%= link_to 'è©¦åˆ æ˜ åƒ', group_video_path(@group), "data-turbo": false, class: "btn btn btn-outline-dark", style: "margin-top: 10px; border-width: 2px; border-radius: 0;" %>

        <%= link_to 'ãƒãƒ¼ãƒˆä¸€è¦§', group_note_path(@group), "data-turbo": false, class: "btn btn btn-outline-dark", style: "margin-top: 10px; border-width: 2px; border-radius: 0;" %>

        <%= link_to 'ç·´ç¿’ãƒ¡ãƒ‹ãƒ¥ãƒ¼', group_practice_path(@group), "data-turbo": false, class: "btn btn btn-outline-dark", style: "margin-top: 10px; border-width: 2px; border-radius: 0;" %>

        <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ããƒœã‚¿ãƒ³ -->
        <%= link_to 'ãƒãƒ¼ãƒˆã‚’æ›¸ã', '', "data-turbo": false, id: "write_note", class: "modal-open btn btn btn-outline-primary", style: "margin-top: 10px; border-width: 2px; border-radius: 0;" %>

        <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«æœ¬ä½“ -->
        <div class="modal-container">
          <div class="modal-body">
            <!-- é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ -->
            <div class="modal-close">Ã—</div>
            <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«å†…ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
            <div class="modal-content">
              <p><span style="font-weight: bold; color: white;">ã“ã®ãƒãƒ¼ãƒˆã¯</span><br>
                <div class="radio-input">
                  <label class="label">
                    <input
                      type="radio"
                      id="value-1"
                      checked=""
                      name="value-radio"
                      value="value-1"
                    />
                    <p class="text">è©¦åˆã®æŒ¯ã‚Šè¿”ã‚Š</p>
                  </label>
                  <label class="label">
                    <input type="radio" id="value-2" name="value-radio" value="value-2" />
                    <p class="text">ç·´ç¿’ã®æŒ¯ã‚Šè¿”ã‚Š</p>
                  </label>
                </div>

                <%# <input type="radio" name="num_of_inq" id="radio-match" value="è©¦åˆã®æŒ¯ã‚Šè¿”ã‚Š" style="margin-top: 10px;"><label for="radio-match" style="margin-left: 5px;">è©¦åˆã®æŒ¯ã‚Šè¿”ã‚Š</label><br>
                <input type="radio" name="num_of_inq" id="radio-practice" value="ç·´ç¿’ã®æŒ¯ã‚Šè¿”ã‚Š"><label for="radio-practice" style="margin-left: 5px;">ç·´ç¿’ã®æŒ¯ã‚Šè¿”ã‚Š</label> %>
              </p>
              <div class="toggle_button" style="color: white;">
                å‹•ç”»ã®æœ‰ç„¡
                <input id="toggle" class="toggle_input" type='checkbox'/>
                <label for="toggle" class="toggle_label" />
              </div>

              <div class="video-index" id="video-index" style="margin-bottom: 10px;">
                <div class="list-group">
                  <% @videos.each_with_index do |video, index| %>
                    <div class="list-group-item list-group-item-action" style="color: white; background-color: #202030;" data-video-id='<%= video.id %>' onclick="selectVideo(this)"><%= video.title %></div>
                  <% end %>
                </div>
              </div>

              <script>
                function getSelectedRadioValue() {
                  const radios = document.getElementsByName('value-radio');
                  let selectedValue;
                  radios.forEach(radio => {
                    if (radio.checked) {
                      selectedValue = radio.value;
                    }
                  });
                  return selectedValue;
                }

                let selectedVideoId;
                function selectVideo(element) {
                  // ã™ã¹ã¦ã®ãƒªã‚¹ãƒˆã‚¢ã‚¤ãƒ†ãƒ ã®outlineã¨æ–‡å­—è‰²ã‚’ãƒªã‚»ãƒƒãƒˆ
                  document.querySelectorAll('.list-group-item').forEach(item => {
                    item.style.outline = '';
                    item.style.color = 'white';
                    item.style.boxShadow = '';
                    item.style.zIndex = '';
                  });
                  // ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã‚¢ã‚¤ãƒ†ãƒ ã®outlineã¨æ–‡å­—è‰²ã‚’è¨­å®š

                  if (element.getAttribute('data-video-id') == selectedVideoId) {
                    selectedVideoId = null;
                    element.style.outline = '';
                    element.style.color = 'white';
                    element.style.boxShadow = '';
                    element.style.zIndex = '';
                    $('#create-note-btn').addClass("disabled");
                  } else {
                    selectedVideoId = element.getAttribute('data-video-id');
                    element.style.outline = '2px solid #435dd8'; // é’è‰²ã®outline
                    element.style.color = 'white';
                    element.style.boxShadow = '0 4px 8px 0 rgba(0, 0, 0, 0.2)';
                    element.style.zIndex = '2'; // æœ€å‰é¢ã«è¡¨ç¤º
                    $("#create-note-btn").removeClass("disabled");
                  }
                }

                // ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹å…¨ä½“ã®å››è§’ã‚’ä¸¸ãã™ã‚‹
                document.addEventListener('DOMContentLoaded', function() {
                  selectedVideoId = null;
                  document.querySelector('.list-group').style.borderRadius = '5px';
                  const toggle = document.getElementById('toggle');
                  if (toggle.checked) {
                    if (selectedVideoId) {
                      $("#create-note-btn").removeClass("disabled");
                    } else {
                      $("#create-note-btn").addClass("disabled");
                    }
                  } else {
                    $("#create-note-btn").removeClass("disabled");
                  }
                });

                document.getElementById('toggle').addEventListener('change', function() {
                  if (this.checked) {
                    if (selectedVideoId) {
                      $("#create-note-btn").removeClass("disabled");
                    } else {
                      $("#create-note-btn").addClass("disabled");
                    }
                  } else {
                    $("#create-note-btn").removeClass("disabled");
                  }
                });

                function createNotePath() {
                  const toggle = document.getElementById('toggle');
                  let path;
                  if (getSelectedRadioValue() == "value-1") { 
                    path = '<%= new_note_path(group_id: @group.id, with_video: false, note_for: "match") %>';
                  } else {
                    path = '<%= new_note_path(group_id: @group.id, with_video: false, note_for: "practice") %>';
                  }
                  
                  if (toggle.checked) {
                    if (selectedVideoId) {
                      $("#create-note-btn").removeClass("disabled");
                      if (getSelectedRadioValue() == "value-1") {
                        path = '<%= new_note_path(group_id: @group.id, with_video: true, note_for: "match") %>' + `&video_id=${selectedVideoId}`;
                      } else {
                        path = '<%= new_note_path(group_id: @group.id, with_video: true, note_for: "practice") %>' + `&video_id=${selectedVideoId}`;
                      }
                    } else {
                      $("#create-note-btn").addClass("disabled");
                    }
                  }
                  return path;
                }
              </script>
              <%= link_to 'ãƒãƒ¼ãƒˆã‚’ä½œæˆ', '#', "data-turbo": false, id: "create-note-btn",class: "btn btn btn-outline-light", style: "margin-top: 10px; border-width: 2px; border-radius: 0;", onclick: "window.location.href = createNotePath();" %>
            </div>
          </div>
        </div>

        <td>
          <div class="row" id="daily_practice_section" style="margin-top: 30px;">
            <div class="container mt-5">
              <h3 class="mb-4">1æ—¥ã®ç·´ç¿’ãƒ¡ãƒ‹ãƒ¥ãƒ¼</h1>

              <div id="calendar">
                <div class="card mt-4 mb-4 w-100 w-lg-50">
                  <%# <div class="card-header">
                    <h2 class="mb-0">1æ—¥ã®ç·´ç¿’ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</h2>
                  </div> %>
                  <div class="card-body">
                    <div id="time-slot" class="row">
                      <!-- å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ç·´ç¿’é …ç›®ã®ã‚«ãƒ¼ãƒ‰ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
                      <% if @group.daily_practice %>
                          <% @group.daily_practice.daily_practice_items.each do |item| %>
                            <%= link_to practice_path(item.practice), "data-turbo": false do %>
                              <div class="col-md-12 mb-3">
                                <div class="card shadow-sm">
                                  <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center">
                                      <div>
                                        <h5 class="card-title" style="text-decoration: none; color: black;"><%= item.practice.name %></h5>
                                        <p class="card-text" style="text-decoration: none; color: black;" id="card-time" data-training-time="<%= item.training_time %>"><%= item.training_time %> åˆ†</p>
                                      </div>
                                      <%= button_to daily_practice_item_path(item), "data-turbo": false, method: :delete, class: "btn" do %>
                                        <i class="fas fa-trash-alt" style="color: black; font-size: 1.2em;"></i>
                                      <% end %>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            <% end %>
                          <% end %>
                      <% else %>
                        <p>ç¾åœ¨ã€ç·´ç¿’ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p>
                      <% end %>
                    </div>
                  </div>
                  
                  <% sum_of_training_time = 0 %>
                  <% @group.daily_practice.daily_practice_items.each do |item| %>
                    <% sum_of_training_time += item.training_time %>
                  <% end %>
                  <div id="sum_of_time" style="margin-left: 20px; margin-bottom: 10px;">åˆè¨ˆ: <%= sum_of_training_time %>åˆ†</div>
                </div>
              </div>
              
              <div class="mb-3">
                <label class="form-label">1æ—¥ã®ç·´ç¿’æ™‚é–“ (åˆ†)</label>
                <input
                  id="total-practice-time"
                  type="number"
                  name="totalPracticeTime"
                  class="form-control w-100 w-lg-50"
                  value="<%= @daily_practice.duration %>"
                />
              </div>

              <div class="mb-3">
                <label class="form-label">ç·´ç¿’ãƒ¡ãƒ‹ãƒ¥ãƒ¼</label>
                <select
                  id="practice-select"
                  name="newItem"
                  class="form-control w-100 w-lg-50"
                >
                  <% @practices.each do |practice| %>
                    <option value="<%= practice.id %>"><%= practice.name %></option>
                  <% end %>
                </select>
                <label class="form-label mt-2">ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ™‚é–“(åˆ†)</label>
                <input
                  type="number"
                  id="practice-time"
                  name="newItemTime"
                  class="form-control w-100 w-lg-50"
                  placeholder="æ™‚é–“ (åˆ†)"
                />
                <button id="add-practice" class="btn btn-primary mt-2" style="border-radius: 0px;" data-group-id="<%= @group.id %>">
                  è¿½åŠ 
                </button>
                <p id="alert" style="color: red;"></p>
              </div>
            </div>
          </div>
        </td>
        
        <!-- ãƒãƒ¼ãƒˆã‚’ä½œæˆæ™‚ã®æ—¥ä»˜ã”ã¨ã«ä¸¦ã¹ã‚‹ -->
        <%= turbo_stream_from "summary_user_#{session.id}" %>
        <%= turbo_stream_from "spinner_summary" %>
        <td>
          <div id="notes-container">
            <% @initial_note_groups.each do |date, notes| %>
              <div class="list-group w-100 w-lg-50 mb-3" data-date="<%= date %>">
                <div class="list-group-item list-group-item-action" style="background-color: black; color: white; border-color: black;">
                  <%= date.strftime('%Yå¹´%mæœˆ%dæ—¥') %>
                </div>
                <% notes.each do |note| %>
                  <a href="<%= note_path(note) %>" class="list-group-item list-group-item-action" data-turbo="false">
                    <%= note.title %>
                    <small class="text-muted">(<%= note.user.username %>)</small>
                  </a>
                <% end %>
              </div>
              <% if Summary.find_by(date_for: date, group_id: @group.id) %>
                <% summary = Summary.find_by(date_for: date, group_id: @group.id) %>
                <div class="fw-bold mb-2">ğŸ¤– AIã«ã‚ˆã‚‹è¦ç´„ ğŸ¤–</div>
                <div style="margin-bottom: 30px;">
                  <%= markdown(summary.content) %>
                </div>
              <% else %>
                <button class="btn btn-outline-primary" style="border-radius: 0px; margin-bottom: 30px;" onclick="createSummary('<%= date %>', <%= @group.id %>)">AIã§è¦ç´„ã™ã‚‹</button>
                <div id="summary_for_<%= date %>"></div>
                <div id="spinner_<%= date %>"></div>
              <% end %>
            <% end %>
          </div>

          <% if @total_date_groups > 5 %>
            <a id="show-more-groups" class="btn mt-2" href="#"
              data-group-id="<%= @group.id %>"
              data-offset="5"
              data-limit="15"
              style="border-radius: 0px; background-color: transparent; color: rgba(90, 90, 90, 0.8); text-decoration: none; cursor: pointer;">
              ã‚‚ã£ã¨è¦‹ã‚‹
            </a>
          <% end %>
        </td>

        <td>
          <div class="row" style="margin-top: 30px;">
            <h4>ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³</h4>
            <div class="details-content row">
              <div class="timeline">
                <% @timeline.each do |item| %>
                  <div class="timeline-item">
                    <% if item.is_a?(Video) %>
                      <%= link_to video_path(item), "data-turbo": false, class: "card mb-4", style: "text-decoration: none; color: black;" do %>
                        <div class="card-body">
                          <h5 class="card-title">æ–°ã—ã„å‹•ç”»ãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã—ãŸï¼</h5>
                          <p class="card-text"><%= item.title %></p>
                          <div class="d-flex justify-content-between align-items-center">
                            <small class="text-muted"><%= time_ago_in_words(item.created_at) %>å‰</small>
                          </div>
                        </div>
                      <% end %>
                    <% elsif item.is_a?(Note) %>
                      <%= link_to note_path(item), "data-turbo": false, style: "text-decoration: none; color: black;" do %>
                        <div class="card mb-4">
                          <div class="card-body">
                            <h5 class="card-title"><%= item.user.username %>ãŒæ–°ã—ã„ãƒãƒ¼ãƒˆã‚’å…±æœ‰ã—ã¾ã—ãŸ!</h5>
                            <p class="card-text"><%= item.title %></p>
                            <div class="d-flex justify-content-between align-items-center">
                              <small class="text-muted"><%= time_ago_in_words(item.created_at) %>å‰</small>
                            </div>
                          </div>
                        </div>
                      <% end %>
                    <% end %>
                  </div>
                <% end %>
              </div>
            </div>
          </div>
        </td>

        <td>
          <% if @group.owner_id == current_user.id %>
            <%= link_to 'Edit', edit_group_path(@group), class: "btn btn-success", style: "margin-top: 30px;"%>
            <%= button_to 'æ‹›å¾…ãƒªãƒ³ã‚¯ã‚’ç™ºè¡Œ', generate_invite_link_group_path(@group), method: :post, class: "btn btn-primary rounded btn-sm", style: "font-size: calc(0.53rem + 0.5vw); margin-top: 10px;" %>
            <%# <%= link_to 'ChatPage', group_chat_path(@group), "data-turbo": false, class: "btn btn-success", style: "margin-top: 10px;"%>
            <%= button_to 'ã“ã®ã‚°ãƒ«ãƒ¼ãƒ—ã‹ã‚‰é€€ä¼š', group_path(@group), method: :delete, class: "btn btn-danger", style: "margin-top: 15px;"%>
            <%= button_to 'ã“ã®ã‚°ãƒ«ãƒ¼ãƒ—ã‚’å‰Šé™¤', group_all_destroy_path(@group), method: :delete, class: "btn btn-danger", style: "margin-top: 10px;"%>
          <% elsif @group.users.include?(current_user) %>
            <%= button_to 'æ‹›å¾…ãƒªãƒ³ã‚¯ã‚’ç™ºè¡Œ', generate_invite_link_group_path(@group), method: :post, class: "btn btn-primary rounded btn-sm", style: "font-size: calc(0.53rem + 0.5vw); margin-top: 15px;" %>
            <%= button_to 'ã“ã®ã‚°ãƒ«ãƒ¼ãƒ—ã‹ã‚‰é€€ä¼š', group_path(@group), method: :delete, class: "btn btn-danger", style: "margin-top: 15px;"%>
          <% end %>
        </td>

    </div>
  </div>
</div>

<script>
  $(function(){
    // å¤‰æ•°ã«è¦ç´ ã‚’å…¥ã‚Œã‚‹
    var open = $('.modal-open'),
      close = $('.modal-close'),
      container = $('.modal-container');

    //é–‹ããƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚‰ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤ºã™ã‚‹
    open.on('click',function(){	
      container.addClass('active');
      return false;
    });

    //é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚‰ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
    close.on('click',function(){	
      container.removeClass('active');
    });

    //ãƒ¢ãƒ¼ãƒ€ãƒ«ã®å¤–å´ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚‰ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
    $(document).on('click',function(e) {
      if(!$(e.target).closest('.modal-body').length) {
        container.removeClass('active');
      }
    });

      const videoIndex = $('#video-index');
      videoIndex.hide();
    // ãƒˆã‚°ãƒ«ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ã‚’ç›£è¦–
    $('#toggle').on('change', function() {
      if (this.checked) {
        videoIndex.show();
      } else {
        videoIndex.hide();
      }
    });
  });

  var sum_of_time = 0;
  $('#time-slot .card .card-body .card-text').each(function() {
    sum_of_time += parseInt($(this).data('training-time'));
  });

  document.getElementById('add-practice').addEventListener('click', function() {
    document.getElementById('calendar').style = '';
    const time = document.getElementById('practice-time').value;
    sum_of_time += parseInt(time);
    const practiceSelect = document.getElementById('practice-select');
    const practiceName = practiceSelect.options[practiceSelect.selectedIndex].text;
    if (time && practiceName) {
      const total_time = parseInt(document.getElementById("total-practice-time").value);
      if (isNaN(total_time)) {
        document.getElementById('alert').innerText = "1æ—¥ã®ç·´ç¿’æ™‚é–“ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚";
        sum_of_time -= parseInt(time);
        return;
      } else if (sum_of_time > total_time) {
        document.getElementById('alert').innerText = "ç·´ç¿’æ™‚é–“ã®åˆè¨ˆãŒã€æŒ‡å®šã—ãŸ1æ—¥ã®ç·´ç¿’æ™‚é–“ã‚’è¶…ãˆã¦ã„ã¾ã™ã€‚";
        sum_of_time -= parseInt(time);
        return;
      } else {
        document.getElementById('alert').innerText = "";
      }

      const groupId = this.getAttribute('data-group-id');
      const practiceId = practiceSelect.options[practiceSelect.selectedIndex].value;
      
      fetch(`/groups/${groupId}/create_daily_practice_item`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').content
        },
        body: JSON.stringify({
          whole_training_time: parseInt(document.getElementById("total-practice-time").value),
          practice_id: practiceId,
          training_time: time
        })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          const practiceCard = document.createElement('div');
          // const csrf_token = document.getElementById("card-body").getAttribute('data-csrf-token');
          practiceCard.className = 'col-md-12 mb-3';
          practiceCard.innerHTML = `
            <div class="card">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                  <div>
                    <h5 class="card-title">${practiceName}</h5>
                    <p class="card-text">${time} åˆ†</p>
                  </div>
                  <form class="button_to" method="post" action="/daily_practice_items/${data.daily_practice_item_id}">
                    <input type="hidden" name="_method" value="delete" autocomplete="off">
                      <button data-turbo="false" class="btn" type="submit">
                        <i class="fas fa-trash-alt" style="color: black; font-size: 1.5em;"></i>
                      </button>
                    <input type="hidden" name="authenticity_token" value="${document.querySelector('meta[name="csrf-token"]').content}" autocomplete="off">
                  </form>
                </div>
              </div>
            </div>
          `;
          document.getElementById('time-slot').appendChild(practiceCard);
          document.getElementById('sum_of_time').innerText = `åˆè¨ˆ: ${sum_of_time}åˆ†`;
        } else {
          console.log(data.error);
        }
      })
      .catch(error => {
        console.error(error);
      });
    }
  });

  document.addEventListener('DOMContentLoaded', function () {
      // URLã«ã‚¢ãƒ³ã‚«ãƒ¼ï¼ˆ#target_sectionï¼‰ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
      const hash = window.location.hash;
      if (hash) {
          const target = document.querySelector(hash);
          if (target) {
            target.scrollIntoView({ behavior: 'instant' });
          }
      }
  });

  document.getElementById('show-more-groups').addEventListener('click', function(event) {
    event.preventDefault();
    showMoreGroups();
  });

  function showMoreGroups() {
    const button = document.getElementById('show-more-groups');
    const groupId = button.getAttribute('data-group-id');
    const offset = parseInt(button.getAttribute('data-offset'));
    const limit = parseInt(button.getAttribute('data-limit'));
    
    fetch(`/groups/${groupId}/load_more_date_groups?offset=${offset}&limit=${limit}`)
      .then(response => response.json())
      .then(data => {
        const notesContainer = document.getElementById('notes-container');

        data.note_groups.forEach(group => {
          const groupDiv = document.createElement('div');
          groupDiv.className = 'list-group w-100 w-lg-50 mb-3';
          groupDiv.setAttribute('data-date', group.date);

          groupDiv.innerHTML = `
            <div class="list-group-item list-group-item-action" style="background-color: black; color: white; border-color: black;">
              ${group.date}
            </div>
          `;

          group.notes.forEach(note => {
            const noteElement = document.createElement('a');
            noteElement.href = `/notes/${note.id}`;
            noteElement.className = 'list-group-item list-group-item-action';
            noteElement.setAttribute('data-turbo', 'false');
            noteElement.innerHTML = `
              ${note.title}
              <small class="text-muted">(${note.username})</small>
            `;
            groupDiv.appendChild(noteElement);
          });

          notesContainer.appendChild(groupDiv);
        });

        // ã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’æ›´æ–°
        const newOffset = offset + data.note_groups.length;
        button.setAttribute('data-offset', newOffset);

        if (!data.has_more) {
          // ã“ã‚Œä»¥ä¸Šã‚°ãƒ«ãƒ¼ãƒ—ãŒãªã„å ´åˆã€ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤ºã«ã™ã‚‹
          button.style.display = 'none';
        }
      })
      .catch(error => {
        console.error('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error);
      });
  }

  function createSummary(date, group_id) {
    fetch('/summaries', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').content
      },
      body: JSON.stringify({
        summary: { 
          date_for: date, 
          group_id: group_id
        }
      })
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        location.reload();
      }
    })
    .catch(error => {
      console.error('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error);
    });
  }
</script>
