var t="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;var e={};function RetryOperation(e,i){"boolean"===typeof i&&(i={forever:i});(this||t)._originalTimeouts=JSON.parse(JSON.stringify(e));(this||t)._timeouts=e;(this||t)._options=i||{};(this||t)._maxRetryTime=i&&i.maxRetryTime||Infinity;(this||t)._fn=null;(this||t)._errors=[];(this||t)._attempts=1;(this||t)._operationTimeout=null;(this||t)._operationTimeoutCb=null;(this||t)._timeout=null;(this||t)._operationStart=null;(this||t)._timer=null;(this||t)._options.forever&&((this||t)._cachedTimeouts=(this||t)._timeouts.slice(0))}e=RetryOperation;RetryOperation.prototype.reset=function(){(this||t)._attempts=1;(this||t)._timeouts=(this||t)._originalTimeouts.slice(0)};RetryOperation.prototype.stop=function(){(this||t)._timeout&&clearTimeout((this||t)._timeout);(this||t)._timer&&clearTimeout((this||t)._timer);(this||t)._timeouts=[];(this||t)._cachedTimeouts=null};RetryOperation.prototype.retry=function(e){(this||t)._timeout&&clearTimeout((this||t)._timeout);if(!e)return false;var i=(new Date).getTime();if(e&&i-(this||t)._operationStart>=(this||t)._maxRetryTime){(this||t)._errors.push(e);(this||t)._errors.unshift(new Error("RetryOperation timeout occurred"));return false}(this||t)._errors.push(e);var r=(this||t)._timeouts.shift();if(void 0===r){if(!(this||t)._cachedTimeouts)return false;(this||t)._errors.splice(0,(this||t)._errors.length-1);r=(this||t)._cachedTimeouts.slice(-1)}var o=this||t;(this||t)._timer=setTimeout((function(){o._attempts++;if(o._operationTimeoutCb){o._timeout=setTimeout((function(){o._operationTimeoutCb(o._attempts)}),o._operationTimeout);o._options.unref&&o._timeout.unref()}o._fn(o._attempts)}),r);(this||t)._options.unref&&(this||t)._timer.unref();return true};RetryOperation.prototype.attempt=function(e,i){(this||t)._fn=e;if(i){i.timeout&&((this||t)._operationTimeout=i.timeout);i.cb&&((this||t)._operationTimeoutCb=i.cb)}var r=this||t;(this||t)._operationTimeoutCb&&((this||t)._timeout=setTimeout((function(){r._operationTimeoutCb()}),r._operationTimeout));(this||t)._operationStart=(new Date).getTime();this._fn((this||t)._attempts)};RetryOperation.prototype.try=function(t){console.log("Using RetryOperation.try() is deprecated");this.attempt(t)};RetryOperation.prototype.start=function(t){console.log("Using RetryOperation.start() is deprecated");this.attempt(t)};RetryOperation.prototype.start=RetryOperation.prototype.try;RetryOperation.prototype.errors=function(){return(this||t)._errors};RetryOperation.prototype.attempts=function(){return(this||t)._attempts};RetryOperation.prototype.mainError=function(){if(0===(this||t)._errors.length)return null;var e={};var i=null;var r=0;for(var o=0;o<(this||t)._errors.length;o++){var s=(this||t)._errors[o];var n=s.message;var a=(e[n]||0)+1;e[n]=a;if(a>=r){i=s;r=a}}return i};var i=e;export default i;

//# sourceMappingURL=retry_operation.js.map